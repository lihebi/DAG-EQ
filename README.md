# Supervised Full DAG Causal Discovery

This is the implementation of our paper [Supervised Whole DAG Causal
Discovery](http://arxiv.org/abs/2006.04697). If
this is helpful for your research, please consider cite our paper.

# Development
A dev container is described in `.devcontainer`. (Note: not VSCode compatible
yet). You should be able to run docker-compose and get a jupyter lab interface
on port http://localhost:8888.

Inside the container, first instantiate julia in the terminal by the following
commands. This is because julia takes long time to initiate, thus without such
pre-init step, you will feel long delay the first time you run the notebooks.

```
julia
]instantiate
]build
]precompile
import CUDA
CUDA.version()
CUDA.has_cuda()
CUDA.has_cutensor()
```

Then open main.ipynb and run the following to train and test the models:

```
include("main.jl")
main()
```

# Running the code

The experiments are sketched in [[file:src/main.jl]]. To run it, you first
instantiate the project invironment, then run

#+begin_example
julia --project src/main.jl
#+end_example

Or you can use the pre-trained models. Pre-trained models can be found at
release page:
- d=10 pre-trained model
- d=20 pre-trained model
- d=50 pre-trained model
- d=100 pre-trained model

Load the pretrained models:

```
@load "/path/to/model.bson" model
```

Data can be generated by:

```
spec = DataSpec(d=10, k=1, gtype=gtype, noise=:Gaussian)
ds, test_ds = spec2ds(spec)
```

Apply the model on the data:

```
x, y = next_batch!(test_ds)
pred = model(x)
loss = myσxent(pred, y)
metric = sup_graph_metrics(cpu(σ.(pred)), cpu(y))
@show metrics
```


# script for other methods

The script for running other method is [[file:src/baseline.py]]. You should install
those methods (various python and R projects) before running the script.
